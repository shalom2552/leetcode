name: Update Readme Table
on:
  push:
    branches: [ main, master ]

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Generate Readme
      run: |
        python3 -c "
        import os
        import urllib.parse
        import re

        GITHUB_USER = 'shalom2552'
        
        # --- 1. The Header (Includes Stats & Your Text) ---
        header = f'''# ðŸš€ LeetCode Portfolio

        A collection of my accepted LeetCode solutions. Focused on efficient algorithms, data structures, and clean code standards.

        <p align=\"center\">
          <img src=\"https://leetcard.jacoblin.cool/{GITHUB_USER}?theme=tokyonight&font=baloo_2&ext=heatmap\" width=\"100%\" alt=\"LeetCode Stats\" />
        </p>

        ## ðŸ“š Solutions
        | # | Problem | Solution | Difficulty |
        |---|---|---|---|
        '''

        problems_data = []

        # --- 2. Scan Folders ---
        for root, dirs, files in os.walk('.'):
            # Skip hidden folders
            if '.git' in root or '.github' in root:
                continue

            # Look for C++ files
            cpp_files = [f for f in files if f.endswith('.cpp')]
            readme_files = [f for f in files if f.lower() == 'readme.md']

            if cpp_files:
                cpp_file = cpp_files[0]
                full_path = os.path.join(root, cpp_file)
                
                # A. Detect Difficulty (Default to Unknown)
                difficulty = 'Unknown'
                badge_color = 'lightgrey'
                
                # Try to read difficulty from the local README
                if readme_files:
                    try:
                        with open(os.path.join(root, readme_files[0]), 'r', encoding='utf-8') as f:
                            content = f.read()
                            if 'Easy' in content: 
                                difficulty = 'Easy'
                                badge_color = 'green'
                            elif 'Medium' in content: 
                                difficulty = 'Medium'
                                badge_color = 'orange'
                            elif 'Hard' in content: 
                                difficulty = 'Hard'
                                badge_color = 'red'
                    except:
                        pass
                
                # B. Fix Repo Link (Handle spaces)
                relative_path = os.path.relpath(full_path, '.')
                url_path = urllib.parse.quote(relative_path)
                
                # C. Fix LeetCode Link (Strip leading zeros/numbers)
                folder_name = os.path.basename(root)
                # Remove '0009-' or '9-' from start
                clean_name = re.sub(r'^\d+-?', '', folder_name) 
                # Create slug (e.g., 'Palindrome Number' -> 'palindrome-number')
                slug = clean_name.lower().strip().replace(' ', '-')
                leetcode_link = f'https://leetcode.com/problems/{slug}'

                # D. Get Problem Number
                match = re.search(r'(\d+)', folder_name)
                problem_num = int(match.group(1)) if match else 9999

                # E. Create Row
                display_name = clean_name.replace('-', ' ').title()
                badge = f'![](https://img.shields.io/badge/-{difficulty}-{badge_color})'
                
                problems_data.append({
                    'num': problem_num,
                    'text': f'| {problem_num} | [{display_name}]({leetcode_link}) | [Code]({url_path}) | {badge} |'
                })

        # --- 3. Sort & Write ---
        problems_data.sort(key=lambda x: x['num'])
        
        readme_content = header
        for p in problems_data:
            readme_content += p['text'] + '\\n'

        with open('README.md', 'w', encoding='utf-8') as f:
            f.write(readme_content)
        "

    - name: Commit and Push
      run: |
        git config --global user.name "GitHub Action"
        git config --global user.email "action@github.com"
        git add README.md
        git commit -m "Update README with stats and description" || exit 0
        git push
